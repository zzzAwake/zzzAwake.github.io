/* ===================================================================
   1. 字体定义与全局变量 (Root & Variables)
   =================================================================== */

@font-face { font-family: 'bulangni'; src: url('') format('truetype'); font-weight: normal; font-style: normal; font-display: swap; }
:root { --screen-width: 350px; --screen-height: 650px; --secondary-bg: #ffffff; --border-color: #e0e0e0; --text-primary: #1f1f1f; --text-secondary: #8a8a8a; --accent-color: #007bff; --chat-font-size: 16px; }

/* ===================================================================
   2. 基础布局与框架样式 (Body, Frame, Screen)
   =================================================================== */

html { height: 100%; overflow: hidden; }
body { height: 100%; overflow: hidden; margin: 0; padding: 20px; font-family: 'bulangni', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; font-weight: normal; background-color: #dcdcdc; display: flex; justify-content: center; align-items: center; box-sizing: border-box; }
#phone-frame { padding: 12px; background-color: #fff; border-radius: 50px; box-shadow: 0 20px 50px rgba(0, 0, 0, 0.25), inset 0 2px 4px rgba(0, 0, 0, 0.1); position: relative; }
#phone-screen { width: var(--screen-width); height: var(--screen-height); background-color: #000; border-radius: 40px; position: relative; overflow: hidden; display: flex; flex-direction: column; border: 2px solid #333; }
.screen { width: 100%; height: 100%; position: absolute; top: 0; left: 0; display: flex; flex-direction: column; overflow: hidden; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; }
.screen.active { opacity: 1; visibility: visible; z-index: 1; }
.notch { position: absolute; top: 12px; left: 50%; transform: translateX(-50%); width: 130px; height: 28px; background-color: #1f1f1f; border-radius: 0 0 15px 15px; z-index: 20; }

/* ===================================================================
   3. 通用 UI 组件 (Headers, Buttons, Forms, Modals, Lists)
   =================================================================== */

/* --- 3.1 头部 (Headers) --- */
.header,
.qzone-header { position: relative; z-index: 15; flex-shrink: 0; padding: 15px 20px; padding-top: 45px; background-color: rgba(247, 247, 247, 0.8); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; font-size: 18px; font-weight: 600; }
.header .header-actions { display: flex; align-items: center; gap: 15px; }
.header .back-btn,
.qzone-header .back-btn { font-size: 24px; cursor: pointer; width: 30px; text-align: center; color: var(--accent-color); display: flex; align-items: center; justify-content: center; }
.header .action-btn { font-size: 16px; font-weight: 600; cursor: pointer; color: var(--accent-color); display: flex; align-items: center; justify-content: center; }
.header .action-btn img { height: 26px; }
#add-chat-btn,
#add-world-book-btn,
#create-album-btn-page { font-size: 28px; font-weight: 300; position: relative; top: -1px; }
.header .save-btn { font-size: 16px; color: var(--accent-color); font-weight: 600; cursor: pointer; }
.header > span:nth-child(2),
#chat-header-title { position: absolute; left: 50%; transform: translateX(calc(-50% - 2px)); max-width: 60%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.qzone-header span:nth-child(2) { position: absolute; left: 50%; transform: translateX(-50%); }

/* --- 3.2 列表容器与表单 (Lists & Forms) --- */
.list-container,
.form-container { padding: 20px; overflow-y: auto; flex-grow: 1; display:flex; flex-direction: column; }
.form-group { margin-bottom: 20px; }
.form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-secondary); }
.form-group input,
.form-group select,
.form-group textarea { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 16px; box-sizing: border-box; }
.form-group textarea { min-height: 80px; resize: vertical; }
.form-button { width: 100%; padding: 15px; background-color: var(--accent-color); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; margin-top: 10px; }
.form-button-secondary { background-color: #f0f0f0; color: var(--text-primary); border: 1px solid var(--border-color); }
.list-item { display: flex; flex-direction: column; padding: 12px 20px; cursor: pointer; border-bottom: 1px solid var(--border-color); }
.list-item:hover { background-color: #f5f5f5; }
.list-item .item-title { font-weight: 500; font-size: 16px; margin-bottom: 5px; }
.list-item .item-content { font-size: 14px; color: var(--text-secondary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

/* --- 3.3 模态框 (Modals) --- */
.modal { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.4); display: none; justify-content: center; align-items: center; z-index: 100; }
.modal.visible { display: flex; }
.modal-content { width: 90%; max-height: 90%; background-color: white; border-radius: 15px; display: flex; flex-direction: column; }
.modal-header { padding: 15px; font-weight: 600; border-bottom: 1px solid var(--border-color); text-align: center; display: flex; justify-content: space-between; align-items: center; }
.modal-body { padding: 15px; overflow-y: auto; }
.modal-footer { padding: 15px; border-top: 1px solid var(--border-color); display: flex; justify-content: space-around; }
.modal-footer button { width: 45%; padding: 12px; border-radius: 8px; border: 1px solid var(--accent-color); cursor: pointer; font-size: 16px; }
.modal-footer .save { background-color: var(--accent-color); color: white; }
.modal-footer .cancel { background-color: white; color: var(--accent-color); }

/* --- 3.4 下拉多选框 (Custom Multiselect) --- */
.custom-multiselect { position: relative; user-select: none; }
.select-box { display: flex; align-items: center; width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 16px; box-sizing: border-box; background-color: #fff; cursor: pointer; }
.select-box .selected-options-text { flex-grow: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: var(--text-primary); }
.select-box .arrow-down { margin-left: auto; font-size: 10px; color: var(--text-secondary); transition: transform 0.2s; }
.select-box.expanded .arrow-down { transform: rotate(180deg); }
.checkboxes-container { display: none; position: absolute; top: 100%; margin-top: 5px; left: 0; right: 0; max-height: 150px; overflow-y: auto; overflow-x: hidden; background-color: #fff; border: 1px solid var(--border-color); border-radius: 8px; z-index: 101; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); }
.checkboxes-container.visible { display: block; }
.checkboxes-container label { display: block; padding: 12px 15px; cursor: pointer; font-weight: normal; color: var(--text-primary); font-size: 15px; }
.checkboxes-container input { margin-right: 10px; vertical-align: middle; }

/* --- 3.5 iOS 风格开关 (Toggle Switch) --- */
.toggle-switch { position: relative; display: inline-block; width: 51px; height: 31px; }
.toggle-switch input { opacity: 0; width: 0; height: 0; }
.slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #e9e9eb; transition: .4s; border-radius: 34px; }
.slider:before { position: absolute; content: ""; height: 27px; width: 27px; left: 2px; bottom: 2px; background-color: white; transition: .4s; border-radius: 50%; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
input:checked + .slider { background-color: #34c759; }
input:checked + .slider:before { transform: translateX(20px); }

/* --- 3.6 其他通用组件 --- */
.avatar-upload { display: flex; align-items: center; gap: 15px; }
.avatar-upload img { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; background-color: #eee; }
.avatar-upload button { padding: 8px 12px; border: 1px solid #ccc; background-color: #f0f0f0; border-radius: 5px; cursor: pointer; }
.avatar-upload input[type="file"] { display: none; }
.unread-indicator { position: absolute; top: -8px; right: -15px; min-width: 18px; height: 18px; padding: 0 5px; background-color: #ff3b30; color: white; font-size: 11px; font-weight: bold; line-height: 18px; text-align: center; border-radius: 9px; box-shadow: 0 1px 2px rgba(0,0,0,0.2); display: none; z-index: 1; }
.back-btn-indicator { top: 0; right: -8px; width: 10px; height: 10px; min-width: 10px; padding: 0; border-radius: 50%; }
.unread-count-wrapper { flex-shrink: 0; width: 40px; display: flex; justify-content: center; align-items: flex-start; padding-top: 20px; }
.unread-count { min-width: 20px; height: 20px; padding: 0 6px; background-color: #ff3b30; color: white; font-size: 13px; font-weight: 500; line-height: 20px; text-align: center; border-radius: 10px; box-shadow: 0 1px 2px rgba(0,0,0,0.15); display: none; justify-content: center; align-items: center; }
.format-helpers { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
.format-btn { background-color: #e9ecef; color: var(--text-primary); border: none; padding: 6px 12px; border-radius: 16px; font-size: 13px; font-weight: 500; cursor: pointer; transition: background-color 0.2s; }
.format-btn:hover { background-color: #dcdfe3; }

/* ===================================================================
   4. 状态栏、通知与主屏幕 (Status Bar, Notifications, Home)
   =================================================================== */

#status-bar { position: absolute; top: 0; left: 0; width: 100%; padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; color: white; z-index: 10; font-size: 14px; box-sizing: border-box; pointer-events: none; }
#status-bar-time { font-weight: 600; }

/* --- 4.1 电池 (Battery) --- */
.battery-container { display: flex; align-items: center; gap: 5px; }
.battery-icon { width: 25px; height: 12px; border: 1px solid white; border-radius: 3px; position: relative; padding: 1px; }
.battery-icon::after { content: ''; position: absolute; right: -3px; top: 2px; width: 2px; height: 6px; background-color: white; border-radius: 0 1px 1px 0; }
.battery-level { height: 100%; background-color: white; border-radius: 1px; transition: width 0.5s ease; }
.battery-container.charging .battery-level { background-color: #4cd964; animation: charge-breath 2s infinite; }
.battery-container.charging .battery-text { color: #4cd964; }

/* --- 4.2 通知栏 (Notification Bar) --- */
#notification-bar { position: absolute; top: 40px; left: 50%; width: 90%; z-index: 500; background-color: rgba(250, 250, 250, 0.9); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border-radius: 16px; padding: 10px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); display: flex; align-items: center; gap: 12px; cursor: pointer; transform: translateX(-50%) translateY(-150%); transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); visibility: hidden; }
#notification-bar.visible { transform: translateX(-50%) translateY(0); visibility: visible; }
#notification-avatar { width: 30px; height: 30px; border-radius: 50%; object-fit: cover; }
#notification-content .name { font-weight: 600; font-size: 15px; color: #000; }
#notification-content .message { font-size: 14px; color: #555; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 200px; }

/* --- 4.3 主屏幕 (Home Screen) --- */
#home-screen { display: flex; flex-direction: column; justify-content: flex-start; align-items: center; padding: 20px; padding-top: 80px; padding-bottom: 50px; box-sizing: border-box; background-size: cover; background-position: center; }
#clock-container { text-align: center; color: white; text-shadow: 0 3px 8px rgba(0, 0, 0, 0.4); margin-bottom: 20px; flex-shrink: 0; }
#main-time { font-size: 80px; font-weight: 200; }
#main-date { font-size: 18px; font-weight: 500; }
#app-grid { margin-top: auto; display: flex; flex-direction: column; align-items: center; gap: 20px; width: 100%; padding: 20px; }
.app-row { display: flex; justify-content: center; gap: 25px; width: 100%; }
.app-icon { display: flex; flex-direction: column; align-items: center; cursor: pointer; color: white; text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5); font-size: 14px; font-weight: 500; text-align: center; }
.app-icon .icon-bg { width: 65px; height: 65px; border-radius: 18px; background-color: var(--secondary-bg); display: flex; justify-content: center; align-items: center; font-size: 32px; margin-bottom: 8px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15); transition: transform 0.2s ease; overflow: hidden; }
.app-icon:active .icon-bg { transform: scale(0.9); }
.app-icon .icon-bg img { width: 100%; height: 100%; object-fit: cover; }
.app-icon .label { color: white; }

/* ===================================================================
   5. 各功能屏幕样式 (App Screens)
   =================================================================== */

/* --- 5.1 设置类屏幕通用 --- */
#api-settings-screen,
#font-settings-screen,
#wallpaper-screen,
#memories-view,
#contact-picker-screen,
#member-management-screen,
#world-book-editor-screen,
#album-screen,
#album-photos-screen,
#browser-screen,
#call-history-screen { background-color: var(--secondary-bg); }
#api-settings-screen .form-container,
#font-settings-screen .form-container,
#wallpaper-screen .form-container { padding-top: 100px; margin-top: -80px; background-color: var(--secondary-bg); min-height: 0; }

/* --- 5.2 世界书 (World Book) --- */
#world-book-screen .action-btn { font-size: 14px; }
#world-book-list { flex-grow: 1; overflow-y: auto; background-color: var(--secondary-bg); padding-top: 80px; margin-top: -80px; }
#world-book-content-input { height: calc(100% - 120px); }
.world-book-group-container { border-bottom: 1px solid var(--border-color); }
.world-book-group-container:first-child { border-top: 1px solid var(--border-color); }
.world-book-group-header,
.wb-category-header { display: flex; align-items: center; padding: 12px 15px; cursor: pointer; background-color: #f7f7f7; font-weight: 600; }
.world-book-group-header .arrow,
.wb-category-header .arrow { font-size: 14px; margin-right: 8px; transition: transform 0.2s ease; }
.world-book-group-header.collapsed .arrow,
.wb-category-header.collapsed .arrow { transform: rotate(-90deg); }
.world-book-group-header .group-name { font-size: 15px; }
.world-book-group-content,
.wb-book-container { max-height: 1000px; overflow: hidden; transition: max-height 0.3s ease-in-out; }
.world-book-group-content.collapsed,
.wb-book-container.collapsed { max-height: 0; }
.wb-category-header { background-color: #f0f2f5; }
.wb-book-container { padding-left: 20px; }
.wb-book-container label { padding: 8px 12px; }
.wb-category-header > span:last-of-type { font-size: 14px; font-weight: 700; color: var(--text-primary); }
#world-book-checkboxes-container .wb-category-header:nth-of-type(6n+1) .arrow { color: #007bff; }
#world-book-checkboxes-container .wb-category-header:nth-of-type(6n+2) .arrow { color: #28a745; }
#world-book-checkboxes-container .wb-category-header:nth-of-type(6n+3) .arrow { color: #fd7e14; }
#world-book-checkboxes-container .wb-category-header:nth-of-type(6n+4) .arrow { color: #6f42c1; }
#world-book-checkboxes-container .wb-category-header:nth-of-type(6n+5) .arrow { color: #dc3545; }
#world-book-checkboxes-container .wb-category-header:nth-of-type(6n+6) .arrow { color: #ffc107; }

/* --- 5.3 外观与字体设置 (Appearance & Font) --- */
#wallpaper-screen .form-container { align-items: center; }
#wallpaper-preview { width: 180px; height: 320px; border: 2px dashed var(--border-color); background-color: #f0f2f5; margin-bottom: 20px; background-size: cover; background-position: center; border-radius: 10px; display: flex; justify-content: center; align-items: center; color: var(--text-secondary); flex-shrink: 0; }
#wallpaper-upload-input { display: none; }
#font-preview { padding: 20px; border: 1px solid var(--border-color); border-radius: 8px; background-color: #f9f9f9; transition: font-family 0.3s ease, background-color 0.3s, border-color 0.3s; }
#font-preview p { color: var(--text-primary); }
#icon-settings-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(70px, 1fr)); gap: 20px; width: 100%; padding: 0 10px; box-sizing: border-box; }
.icon-setting-item { display: flex; flex-direction: column; align-items: center; gap: 8px; }
.icon-preview { width: 60px; height: 60px; border-radius: 15px; background-size: cover; background-position: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
.change-icon-btn { padding: 4px 10px; font-size: 12px; border: 1px solid #ccc; background-color: #f0f0f0; border-radius: 5px; cursor: pointer; }

/* --- 5.4 浏览器 (Browser) --- */
#browser-content { padding: 20px; font-size: 16px; line-height: 1.8; color: #333; overflow-y: auto; }
#browser-content .article-title { font-size: 24px; font-weight: 700; margin-bottom: 10px; }
#browser-content .article-meta { font-size: 13px; color: #8a8a8a; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid #e0e0e0; }
#browser-content .article-body { white-space: pre-wrap; word-break: break-word; }
#browser-content .article-body p { margin-bottom: 1em; }

/* ===================================================================
   6. 聊天列表与相关视图 (Chat List & Views)
   =================================================================== */

/* --- 6.1 视图切换框架 --- */
.chat-list-view { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; opacity: 0; visibility: hidden; transition: opacity 0.2s, visibility 0.2s; z-index: 1; }
.chat-list-view.active { opacity: 1; visibility: visible; z-index: 2; }
#messages-view { overflow-y: auto; }
#favorites-view, #memories-view { display: flex; flex-direction: column; }
#favorites-view > .header, #memories-view > .header { flex-shrink: 0; }

/* --- 6.2 底部导航栏 (Bottom Nav) --- */
#chat-list-bottom-nav { position: absolute; bottom: 0; left: 0; width: 100%; z-index: 15; display: flex; border-top: 1px solid var(--border-color); background-color: rgba(247, 247, 247, 0.9); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); }
.nav-item { flex: 1; text-align: center; padding: 12px 0; font-size: 14px; color: var(--text-secondary); cursor: pointer; transition: color 0.2s; }
.nav-item.active { color: var(--accent-color); font-weight: 600; }

/* --- 6.3 消息列表 (Message List) --- */
#chat-list { flex-grow: 1; background-color: var(--secondary-bg); padding-top: 80px; padding-bottom: 50px; box-sizing: border-box; }
.chat-list-item { display: flex; align-items: center; padding: 10px 15px; cursor: pointer; border-bottom: 1px solid var(--border-color); position: relative; }
.chat-list-item:hover { background-color: #f5f5f5; }
.chat-list-item:first-child, .chat-group-container:first-child { margin-top: 10px; }
.chat-list-item .avatar { width: 45px; height: 45px; border-radius: 50%; margin-right: 12px; object-fit: cover; background-color: #ccc; }
.chat-list-item .info { flex-grow: 1; overflow: hidden; }
.chat-list-item .name-line { display: flex; align-items: center; gap: 6px; margin-bottom: 2px; }
.chat-list-item .name { font-weight: 500; color: var(--text-primary); }
.chat-list-item .group-tag { font-size: 10px; color: var(--accent-color); background-color: #e7f3ff; padding: 2px 6px; border-radius: 4px; font-weight: bold; flex-shrink: 0; }
.chat-list-item .last-msg { font-size: 13px; color: var(--text-secondary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 180px; }
#chat-list-title { cursor: pointer; }
.chat-group-container { border-bottom: 1px solid var(--border-color); }
.chat-group-container:first-child { border-top: 1px solid var(--border-color); }
.chat-group-header { display: flex; align-items: center; padding: 12px 15px; cursor: pointer; background-color: #f7f7f7; }
.chat-group-header .arrow { font-size: 14px; margin-right: 8px; transition: transform 0.2s ease; }
.chat-group-header.collapsed .arrow { transform: rotate(-90deg); }
.chat-group-header .group-name { font-weight: 600; font-size: 15px; }
.chat-group-content { max-height: 1000px; overflow: hidden; transition: max-height 0.3s ease-in-out; }
.chat-group-content.collapsed { max-height: 0; }

/* --- 6.4 收藏 (Favorites) --- */
#favorites-list { flex-grow: 1; overflow-y: auto; overflow-x: hidden; padding: 15px; display: flex; flex-direction: column; gap: 15px; }
.search-bar-container { padding: 10px 15px; background-color: #f9f9f9; position: relative; flex-shrink: 0; }
#favorites-search-input { width: 100%; padding: 10px 30px 10px 15px; font-size: 14px; border: 1px solid var(--border-color); border-radius: 18px; background-color: var(--secondary-bg); box-sizing: border-box; outline: none; }
#favorites-search-input:focus { border-color: var(--accent-color); }
.search-clear-btn { position: absolute; right: 25px; top: 50%; transform: translateY(-50%); background: #ccc; color: white; border: none; border-radius: 50%; width: 20px; height: 20px; line-height: 20px; text-align: center; font-size: 16px; cursor: pointer; }
.favorite-item-card { background-color: var(--secondary-bg); border-radius: 12px; padding: 15px; box-shadow: 0 1px 4px rgba(0,0,0,0.06); position: relative; }
.fav-card-header { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; }
.fav-card-header .avatar { width: 36px; height: 36px; border-radius: 50%; object-fit: cover; }
.fav-card-header .info { flex-grow: 1; }
.fav-card-header .name { font-weight: 600; font-size: 15px; }
.fav-card-header .source { font-size: 12px; color: var(--text-secondary); }
.fav-card-content { font-size: 14px; line-height: 1.6; color: #333; white-space: pre-wrap; word-break: break-word; }
.fav-card-content .chat-image { margin-top: 8px; }
.fav-delete-btn { position: absolute; top: 10px; right: 10px; width: 28px; height: 28px; background: #f0f2f5; border: none; border-radius: 50%; cursor: pointer; font-size: 18px; color: var(--text-secondary); line-height: 28px; text-align: center; }
.fav-delete-btn:hover { background-color: #e9ecef; color: #ff3b30; }
#favorites-view.selection-mode .favorite-item-card { transition: transform 0.2s ease, box-shadow 0.2s ease; transform: translateX(35px); }
#favorites-view.selection-mode .favorite-item-card::before { content: ''; position: absolute; left: -25px; top: 50%; transform: translateY(-50%); width: 20px; height: 20px; border: 2px solid #ccc; border-radius: 50%; background-color: white; transition: all 0.2s ease; opacity: 1; }
#favorites-view.selection-mode .favorite-item-card.selected::before { background-color: var(--accent-color); border-color: var(--accent-color); content: '✔'; color: white; font-size: 14px; text-align: center; line-height: 20px; }
#favorites-action-bar { position: absolute; bottom: 0; left: 0; right: 0; width: auto; padding: 10px 15px; padding-bottom: calc(10px + env(safe-area-inset-bottom)); background-color: rgba(247, 247, 247, 0.9); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border-top: 1px solid var(--border-color); box-sizing: border-box; z-index: 5; display: none; }
#favorites-action-bar .action-bar-btn { width: 100%; padding: 12px; border-radius: 8px; border: none; font-size: 16px; font-weight: 600; cursor: pointer; background-color: #ff3b30; color: white; }

/* --- 6.5 回忆录 (Memories) --- */
#memories-list { padding: 15px; display: flex; flex-direction: column; gap: 15px; }

/* --- 6.6 通话记录 (Call History) --- */
#call-history-list { padding: 15px; display: flex; flex-direction: column; gap: 15px; }
.call-record-card { background-color: var(--secondary-bg); border-radius: 12px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease; border-left: 5px solid var(--accent-color); }
.call-record-card:hover { transform: translateY(-3px); box-shadow: 0 6px 12px rgba(0,0,0,0.1); }
.call-record-card .card-header { display: flex; justify-content: space-between; align-items: center; font-size: 13px; color: var(--text-secondary); margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid var(--border-color); }
.call-record-card .card-header .duration { font-weight: 500; color: var(--text-primary); }
.call-record-card .card-body { display: flex; flex-direction: column; gap: 8px; }
.call-record-card .custom-title { font-size: 16px; font-weight: 600; color: var(--text-primary); padding-bottom: 8px; border-bottom: 1px solid var(--border-color); margin-bottom: 4px; }
.call-record-card .participants-info { display: flex; align-items: center; }
.call-record-card .participants-avatars { display: flex; align-items: center; }
.call-record-card .participant-avatar { width: 36px; height: 36px; border-radius: 50%; object-fit: cover; border: 2px solid white; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
.call-record-card .participant-avatar:not(:first-child) { margin-left: -12px; }
.call-record-card .participants-names { margin-left: 12px; font-weight: 500; font-size: 14px; color: var(--text-secondary); }

/* ===================================================================
   7. 聊天界面 (Chat Interface)
   =================================================================== */

/* --- 7.1 布局与输入框 --- */
#chat-interface-screen { background-size: cover; background-position: center; position: relative; }
#chat-messages { flex-grow: 1; overflow-y: auto; overflow-x: hidden; padding: 10px 15px 20px; padding-top: 110px; margin-top: -80px; display: flex; flex-direction: column; gap: 20px; box-sizing: border-box; }
#chat-input-area { flex-shrink: 0; padding: 8px; background-color: rgba(247, 247, 247, 0.8); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border-top: 1px solid var(--border-color); display: flex; flex-direction: column; gap: 5px; }
#chat-input-main-row { display: flex; align-items: flex-end; gap: 8px; width: 100%; }
#chat-input { flex-grow: 1; border: none; padding: 10px 15px; border-radius: 20px; background-color: var(--secondary-bg); font-size: 16px; max-height: 100px; resize: none; }
#input-actions-wrapper { position: static; display: flex; align-items: flex-end; gap: 8px; flex-shrink: 0; }
#chat-input-actions-top { display: flex; gap: 8px; padding: 0 5px; overflow-x: auto; flex-wrap: nowrap; -webkit-overflow-scrolling: touch; scrollbar-width: none; -ms-overflow-style: none; }
#chat-input-actions-top::-webkit-scrollbar { display: none; }
.chat-action-icon-btn { font-size: 24px; padding: 0; width: 38px; height: 38px; line-height: 38px; text-align: center; border-radius: 50%; background-color: rgba(255, 255, 255, 0.5); color: var(--text-primary); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); border: 1px solid rgba(0, 0, 0, 0.05); cursor: pointer; display: flex; justify-content: center; align-items: center; }
#send-btn { background-color: var(--accent-color); color: white; border: none; border-radius: 20px; cursor: pointer; font-weight: 600; font-size: 14px; flex-shrink: 0; height: 40px; padding: 0 15px; }
#wait-reply-btn { position: static; bottom: auto; right: auto; width: auto; height: 40px; padding: 0 10px; border-radius: 20px; display: flex; align-items: center; justify-content: center; background-color: rgba(255, 255, 255, 0.6); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); border: 1px solid rgba(0,0,0,0.08); box-shadow: 0 2px 5px rgba(0,0,0,0.1); transition: opacity 0.2s, transform 0.1s; cursor: pointer; }
#wait-reply-btn:hover { opacity: 0.8; }
#wait-reply-btn:active { transform: scale(0.9); }
#wait-reply-btn img { height: 22px; display: block; margin: auto; }

/* --- 7.2 聊天头部状态 --- */
#chat-header-title-wrapper { display: flex; flex-direction: column; align-items: center; gap: 2px; position: absolute; left: 50%; transform: translateX(-50%); max-width: 60%; }
#chat-header-title { font-size: 16px; font-weight: 600; position: static; transform: none; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%; transition: opacity 0.2s ease-in-out; }
#chat-header-status { display: flex; align-items: center; gap: 5px; font-size: 11px; color: var(--text-secondary); transition: all 0.3s ease; cursor: pointer; }
.status-dot { width: 7px; height: 7px; border-radius: 50%; background-color: #4cd964; transition: background-color 0.3s ease; }
#chat-header-status.busy .status-dot { background-color: #cccccc; }
.status-text { font-weight: 500; }
#chat-header-title.typing-status { color: var(--text-secondary); animation: typing-pulse 1.5s infinite; font-style: italic; }

/* --- 7.3 多选模式 --- */
#chat-interface-screen .header .default-controls { display: flex; justify-content: space-between; align-items: center; width: 100%; }
#chat-interface-screen .header .selection-controls { display: none; justify-content: space-between; align-items: center; width: 100%; }
#chat-interface-screen.selection-mode .header .default-controls { display: none; }
#chat-interface-screen.selection-mode .header .selection-controls { display: flex; }
#selection-cancel-btn, #selection-delete-btn, #selection-favorite-btn, #selection-share-btn { font-size: 16px; color: var(--accent-color); cursor: pointer; padding: 5px; }
#selection-delete-btn { color: #ff3b30; }

/* --- 7.4 聊天锁定遮罩 --- */
#chat-lock-overlay { position: absolute; bottom: 0; left: 0; width: 100%; background-color: rgba(247, 247, 247, 0.9); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); z-index: 150; display: none; align-items: center; justify-content: center; padding: 20px; box-sizing: border-box; border-top: 1px solid var(--border-color); text-align: center; }
#chat-lock-content { display: flex; flex-direction: column; gap: 15px; }
#chat-lock-content .lock-text { color: var(--text-secondary); font-size: 14px; }
#chat-lock-content .lock-action-btn { padding: 10px 20px; border-radius: 20px; border: 1px solid var(--accent-color); background-color: var(--accent-color); color: white; cursor: pointer; }
#chat-lock-content .lock-action-btn.secondary { background-color: transparent; color: var(--accent-color); }

/* --- 7.5 表情面板 (Sticker Panel) --- */
#sticker-panel { position: absolute; bottom: 0; left: 0; width: 100%; height: 50%; background-color: rgba(242, 242, 247, 0.85); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); border-top: 1px solid var(--border-color); border-radius: 20px 20px 0 0; z-index: 200; display: flex; flex-direction: column; transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); visibility: hidden; }
#sticker-panel.visible { transform: translateY(0); visibility: visible; }
#sticker-panel-header { padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; border-bottom: 1px solid var(--border-color); }
#sticker-panel-header .title { font-weight: 600; }
#sticker-panel-header .panel-btn { font-size: 16px; padding: 5px 10px; cursor: pointer; color: var(--accent-color); }
#sticker-grid { flex-grow: 1; overflow-y: auto; padding: 15px; display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 15px; }
.sticker-item { position: relative; aspect-ratio: 1 / 1; background-color: white; border-radius: 10px; background-size: contain; background-repeat: no-repeat; background-position: center; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
.sticker-item .delete-btn { display: none; position: absolute; top: -5px; right: -5px; width: 20px; height: 20px; background-color: #ff3b30; color: white; border-radius: 50%; text-align: center; line-height: 20px; font-size: 14px; cursor: pointer; border: 2px solid white; }

/* ===================================================================
   8. 消息气泡与内容 (Message Bubbles & Contents)
   =================================================================== */

/* --- 8.1 气泡基础布局 (Bubble Layout) --- */
.message-wrapper { display: flex; gap: 8px; align-items: flex-end; position: relative; max-width: 90%; }
.message-wrapper.ai { align-self: flex-start; flex-direction: row; }
.message-wrapper.user { align-self: flex-end; flex-direction: row-reverse; }
.message-bubble { display: flex; align-items: flex-start; gap: 12px; max-width: 100%; }
.message-bubble.user { flex-direction: row-reverse; }
.message-bubble .avatar { width: 34px; height: 34px; border-radius: 20%; object-fit: cover; flex-shrink: 0; }
.timestamp { font-size: 11px; color: #999; text-shadow: 0 0 3px rgba(255, 255, 255, 0.6); white-space: nowrap; margin-bottom: 5px; flex-shrink: 0; }
.sender-name { font-size: 11px; color: #666; margin-bottom: 3px; }
.message-wrapper.ai .sender-name { margin-left: 50px; position: absolute; top: -16px; left: 0; }
.message-bubble.selected::after { content: '✔'; position: absolute; left: -10px; top: 50%; transform: translateY(-50%); background-color: var(--accent-color); color: white; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; }
.message-bubble.user.selected::after { left: auto; right: -10px; }
.message-wrapper.animate-in { animation: message-pop-in 0.3s cubic-bezier(0.25, 0.1, 0.25, 1) forwards; }

/* --- 8.2 气泡主题与内容 (Bubble Themes & Content) --- */
.message-bubble .content { position: relative; font-size: var(--chat-font-size); padding: 8px 12px; line-height: 1.5; word-break: break-word; }
.message-bubble.user .content { background-color: var(--user-bg); color: var(--user-text); border-radius: 8px 2px 8px 8px; }
.message-bubble.ai .content { background-color: var(--ai-bg); color: var(--ai-text); border-radius: 2px 8px 8px 8px; }
#chat-messages[data-theme="default"]       { --user-bg: rgba(255, 255, 255, 0.75); --user-text: #585858; --ai-bg: rgba(255, 255, 255, 0.7); --ai-text: #585858; }
#chat-messages[data-theme="pink_blue"]     { --user-bg: #fff0f6; --user-text: #432531; --ai-bg: #eff7ff; --ai-text: #263a4e; }
#chat-messages[data-theme="blue_white"]    { --user-bg: #eff7ff; --user-text: #263a4e; --ai-bg: #f8f9fa; --ai-text: #383d41; }
#chat-messages[data-theme="purple_yellow"] { --user-bg: #faf7ff; --user-text: #827693; --ai-bg: #fffde4; --ai-text: #5C4033; }
#chat-messages[data-theme="black_white"]   { --user-bg: #343a40; --user-text: #f8f9fa; --ai-bg: #f8f9fa; --ai-text: #343a40; }
#chat-messages[data-theme="yellow_white"]  { --user-bg: #FFEB3B; --user-text: #5D4037; --ai-bg: #f8f9fa; --ai-text: #383d41; }
#chat-messages[data-theme="red_black"]     { --user-bg: #C62828; --user-text: #FFFFFF; --ai-bg: #212121; --ai-text: #FFFFFF; }
#chat-messages[data-theme="blue_yellow"]   { --user-bg: #A0D2EB; --user-text: #153243; --ai-bg: #FEF9E7; --ai-text: #5D4037; }
#chat-messages[data-theme="pink_yellow"]   { --user-bg: #fff0f6; --user-text: #432531; --ai-bg: #FEF9E7; --ai-text: #5D4037; }
#chat-messages[data-theme="pink_purple"]   { --user-bg: #fff0f6; --user-text: #a78396; --ai-bg: #faf7ff; --ai-text: #827693; }
#chat-messages[data-theme="gray_white"]    { --user-bg: #e9ecef; --user-text: #495057; --ai-bg: #f8f9fa; --ai-text: #383d41; }
#chat-messages[data-theme="blue_green"]    { --user-bg: #d1ecf1; --user-text: #0c5460; --ai-bg: #d4edda; --ai-text: #155724; }
#chat-messages[data-theme="pink_white"]    { --user-bg: #fff0f6; --user-text: #a78396; --ai-bg: #f8f9fa; --ai-text: #383d41; }
#chat-messages[data-theme="pink_black"]    { --user-bg: #F8BBD0; --user-text: #5B2C6F; --ai-bg: #343a40; --ai-text: #f8f9fa; }
#chat-messages[data-theme="pink_green"]    { --user-bg: #F8BBD0; --user-text: #5B2C6F; --ai-bg: #C8E6C9; --ai-text: #1B5E20; }
#chat-messages[data-theme="green_black"]   { --user-bg: #d4edda; --user-text: #155724; --ai-bg: #343a40; --ai-text: #f8f9fa; }

/* --- 8.3 特殊内容通用样式 --- */
.message-bubble.is-sticker .content,
.message-bubble.is-voice-message .content,
.message-bubble.is-ai-image .content,
.message-bubble.is-transfer .content,
.message-bubble.is-waimai-request .content,
.message-bubble.is-red-packet .content,
.message-bubble.is-poll .content,
.message-bubble.is-link-share .content { padding: 0; background-color: transparent; box-shadow: none; border: none; backdrop-filter: none; -webkit-backdrop-filter: none; }
.chat-image, .ai-generated-image { max-width: 100%; border-radius: 10px; display: block; }
.ai-generated-image { max-width: 180px; border-radius: 12px; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
.ai-generated-image:hover { transform: scale(1.05); box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); }
.message-bubble.has-image .content { padding: 5px; }
.sticker-image { max-width: 100px; max-height: 100px; display: block; object-fit: contain; }

/* --- 8.4 系统/撤回/拍一拍消息 --- */
.system-message, .recalled-message-placeholder { align-self: center; padding: 4px 12px; margin: 5px 0; background-color: rgba(0, 0, 0, 0.1); color: var(--text-secondary); font-size: 12px; border-radius: 10px; text-align: center; max-width: 80%; }
.message-wrapper.system-pat { justify-content: center; align-self: center; margin: 5px 0; max-width: 80%; }
.message-bubble.system-bubble { background-color: rgba(0, 0, 0, 0.1); color: var(--text-secondary); font-size: 12px; padding: 4px 12px; border-radius: 10px; }
.recalled-message-placeholder { cursor: pointer; white-space: nowrap; display: inline-block; }
.pat-animation { animation: pat-shake 0.4s ease-in-out; }
.message-wrapper.recalled-animation { animation: recall-animation 0.3s ease-out forwards; }

/* --- 8.5 引用回复 (Quote Reply) --- */
#reply-preview-bar { display: none; padding: 8px 12px; margin: 0 8px 8px 8px; background-color: rgba(0, 0, 0, 0.05); border-left: 3px solid var(--accent-color); border-radius: 6px; position: relative; font-size: 13px; color: var(--text-secondary); }
.reply-preview-content .sender { font-weight: 600; color: var(--text-primary); }
.reply-preview-content .text { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: block; max-width: 95%; }
#cancel-reply-btn { position: absolute; top: 50%; right: 8px; transform: translateY(-50%); width: 20px; height: 20px; line-height: 20px; text-align: center; border-radius: 50%; background-color: rgba(0,0,0,0.1); cursor: pointer; font-size: 14px; }
.quoted-message { padding: 6px 10px; margin-bottom: 6px; background-color: rgba(0, 0, 0, 0.04); border-left: 2px solid var(--accent-color); border-radius: 4px; font-size: 0.9em; opacity: 0.8; }
.quoted-message .quoted-sender { font-weight: 600; color: var(--accent-color); }
.quoted-message .quoted-content { color: var(--text-secondary); white-space: normal; word-break: break-word; display: block; }

/* --- 8.6 语音消息 (Voice Message) --- */
.voice-message-body { display: flex; align-items: center; cursor: pointer; padding: 8px 12px; min-width: 80px; max-width: 200px; }
.message-bubble.user .voice-message-body { color: #1a3d00; flex-direction: row-reverse; }
.message-bubble.ai .voice-message-body { color: var(--text-primary); }
.voice-waveform { display: flex; align-items: center; height: 20px; gap: 2px; flex-grow: 1; margin: 0 10px; }
.voice-waveform div { width: 3px; background-color: currentColor; border-radius: 2px; animation: wave-quiet 1.5s ease-in-out infinite; }
.voice-waveform div:nth-child(2) { animation-delay: 0.2s; }
.voice-waveform div:nth-child(3) { animation-delay: 0.4s; }
.voice-waveform div:nth-child(4) { animation-delay: 0.6s; }
.voice-waveform div:nth-child(5) { animation-delay: 0.8s; }
.voice-duration { font-size: var(--chat-font-size, 13px); font-weight: 500; color: var(--text-secondary); }
.message-bubble.user .voice-duration { color: #3e6224; }
.voice-transcript { font-size: 14px; line-height: 1.6; color: var(--text-secondary); padding: 8px 12px; margin-top: 6px; background-color: rgba(0, 0, 0, 0.04); border-radius: 6px; word-break: break-word; display: none; }
.loading-spinner { display: none; width: 16px; height: 16px; border: 2px solid rgba(0, 0, 0, 0.2); border-top-color: var(--accent-color); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 8px; }

/* --- 8.7 转账 (Transfer) --- */
.transfer-card { width: 200px; border-radius: 12px; padding: 12px; color: white; position: relative; overflow: hidden; }
.transfer-card::before { content: '🐾'; position: absolute; right: 10px; top: 5px; font-size: 30px; opacity: 0.2; transform: rotate(15deg); }
.message-bubble.user .transfer-card { background: radial-gradient(circle at top left, #ffc5d5, #ff85b3); }
.message-bubble.ai .transfer-card { background: radial-gradient(circle at top left, #a1c4fd, #c2e9fb); }
.transfer-title, .transfer-amount, .transfer-note { text-shadow: none !important; color: white !important; }
.transfer-title { font-size: 16px !important; font-weight: 600 !important; display: flex; align-items: center; gap: 6px; margin-bottom: 8px; }
.transfer-amount { font-size: 28px !important; font-weight: bold !important; margin-bottom: 4px; }
.transfer-note { font-size: 13px !important; opacity: 0.9 !important; border-top: 1px solid rgba(255,255,255,0.3); padding-top: 8px; margin-top: 8px; word-break: break-all; }
#transfer-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 1001; }
#transfer-modal.visible { display: flex; }
.transfer-content { background-color: #fff0f5; border-radius: 20px; width: 290px; padding: 20px; box-shadow: 0 5px 25px rgba(255, 105, 180, 0.3); text-align: center; background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100" opacity="0.05"><path d="M50,4 C35,4 28,15 28,24 C28,33 35,32 35,40 C35,48 28,49 28,57 C28,65 35,66 35,74 C35,82 28,83 28,91 C28,99 35,100 50,100 C65,100 72,99 72,91 C72,83 65,82 65,74 C65,66 72,65 72,57 C72,49 65,48 65,40 C65,32 72,33 72,24 C72,15 65,4 50,4 Z" fill="%23FF69B4"/></svg>'); background-repeat: no-repeat; background-position: top right; background-size: 80px; }
.transfer-header { font-size: 20px; font-weight: bold; color: #a35c7b; margin-bottom: 20px; }
.transfer-input-group { margin-bottom: 15px; text-align: left; }
.transfer-input-group label { display: block; font-size: 14px; color: #ff85b3; margin-bottom: 5px; font-weight: 500; }
.transfer-input-group input { width: 100%; padding: 12px; border-radius: 10px; border: 2px solid #ffcce0; background-color: #fff; font-size: 16px; box-sizing: border-box; }
.transfer-input-group input:focus { border-color: #ff85b3; outline: none; }
.transfer-actions { display: flex; justify-content: space-between; gap: 10px; }
.transfer-actions button { flex: 1; padding: 12px; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; transition: transform 0.2s; }
.transfer-actions button:active { transform: scale(0.95); }
#transfer-cancel-btn { background-color: #ffdde9; color: #a35c7b; }
#transfer-confirm-btn { background-color: #ff85b3; color: white; }

/* --- 8.8 外卖 (Waimai) --- */
.waimai-card { width: 240px; border-radius: 12px; overflow: hidden; background-color: #fff; box-shadow: 0 4px 12px rgba(0,0,0,0.1); font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
.waimai-header { display: flex; align-items: center; gap: 8px; padding: 10px 12px; border-bottom: 1px solid #f0f0f0; }
.waimai-header .icon { width: 20px; height: 20px; }
.waimai-header .title-group { display: flex; align-items: baseline; font-size: 14px; color: #8a8a8a; }
.waimai-header .title-group .brand { font-weight: 600; color: #555; margin-right: 5px; }
.waimai-header .title-group .separator { margin: 0 5px; }
.waimai-catchphrase { font-size: 13px; color: #1f1f1f; padding: 12px; }
.waimai-main { background-color: #FFD66B; padding: 12px; text-align: center; }
.waimai-main .request-title { font-size: 12px; color: #856404; margin-bottom: 8px; }
.waimai-main .payment-box { background-color: #fff; border-radius: 8px; padding: 15px 10px; }
.waimai-main .payment-label { font-size: 13px; color: #8a8a8a; }
.waimai-main .amount { font-size: 32px; font-weight: 700; color: #1f1f1f; margin: 4px 0 12px 0; }
.waimai-main .countdown-label { font-size: 13px; color: #8a8a8a; }
.waimai-main .countdown-timer { display: inline-flex; align-items: center; gap: 2px; margin-left: 5px; }
.waimai-main .countdown-timer span { background-color: #333; color: white; padding: 2px 4px; border-radius: 2px; font-weight: bold; font-size: 12px; }
.waimai-details-btn { width: 100%; padding: 10px 0; margin-top: 15px; border: none; border-radius: 6px; background-color: #FFC33A; color: #49380a; font-size: 14px; font-weight: 600; cursor: pointer; }
.waimai-user-actions { display: flex; gap: 10px; padding: 0 12px 12px 12px; background-color: #fff; }
.waimai-user-actions button { flex: 1; padding: 10px; border-radius: 8px; border: 1.5px solid; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s ease; }
.waimai-pay-btn { background-color: #28a745; border-color: #1f7a33; color: white; }
.waimai-pay-btn:hover { background-color: #218838; }
.waimai-decline-btn { background-color: #f8f9fa; border-color: #ced4da; color: #495057; }
.waimai-decline-btn:hover { background-color: #e2e6ea; }
.message-bubble.status-paid .waimai-card { border: 2px solid #28a745; }
.message-bubble.status-rejected .waimai-card { border: 2px solid #dc3545; opacity: 0.8; }
.message-bubble.status-rejected .waimai-main { background-color: #e9ecef; }
.message-bubble.status-paid .payment-box, .message-bubble.status-rejected .payment-box { display: none; }
.message-bubble.status-paid .waimai-details-btn { background-color: #28a745; color: white; }
.message-bubble.status-rejected .waimai-details-btn { background-color: #6c757d; color: white; }
.message-bubble[class*="status-"] .request-title { font-size: 0; }
.message-bubble[class*="status-"] .request-title::after { font-size: 14px; font-weight: 600; }
.message-bubble.status-paid .request-title::after { content: "我已为您买单，请尽情享用吧～"; color: #155724; }
.message-bubble.status-rejected .request-title::after { content: "我拒绝了您的代付请求"; color: #721c24; }

/* --- 8.9 红包 (Red Packet) --- */
.red-packet-card { width: 220px; border-radius: 8px; background: linear-gradient(160deg, #F96259, #E44D44); color: #ffd700; padding: 12px; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.1); position: relative; overflow: hidden; }
.red-packet-card.opened { background: linear-gradient(160deg, #d3c4a0, #c4b693); cursor: default; }
.red-packet-card::before { content: '🧧'; position: absolute; top: -5px; left: -5px; font-size: 30px; opacity: 0.2; transform: rotate(-10deg); }
.rp-header { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
.rp-icon { width: 20px; height: 20px; }
.rp-greeting { font-size: 15px; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.rp-type { font-size: 11px; color: white; opacity: 0.8; border-top: 1px solid rgba(255, 255, 255, 0.2); padding-top: 8px; margin-top: 8px; }
.rp-claimed-info { font-size: 13px; color: white; margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.3); }

/* --- 8.10 投票 (Poll) --- */
.poll-card { width: 250px; background-color: #f9f9f9; border-radius: 10px; border: 1px solid #e0e0e0; padding: 12px; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
.poll-card.closed { background-color: #e9ecef; }
.poll-question { font-weight: 600; font-size: 15px; margin-bottom: 12px; line-height: 1.4; word-break: break-word; }
.poll-options-list { display: flex; flex-direction: column; gap: 8px; }
.poll-option-item { background-color: white; border: 1px solid #dcdcdc; border-radius: 8px; padding: 10px; cursor: pointer; position: relative; overflow: hidden; transition: background-color 0.2s; }
.poll-card:not(.closed) .poll-option-item:hover { background-color: #f0f8ff; }
.poll-option-item.voted { border-color: var(--accent-color); background-color: #e7f3ff; font-weight: 500; }
.poll-option-bar { position: absolute; top: 0; left: 0; height: 100%; background-color: rgba(0, 123, 255, 0.1); z-index: 1; transition: width 0.3s ease-in-out; }
.poll-option-content { position: relative; z-index: 2; display: flex; justify-content: space-between; align-items: center; }
.poll-option-text { font-size: 14px; }
.poll-option-votes { font-size: 13px; color: #8a8a8a; font-weight: 500; }
.poll-footer { margin-top: 12px; padding-top: 8px; border-top: 1px solid #e9e9e9; display: flex; justify-content: space-between; align-items: center; font-size: 12px; color: var(--text-secondary); }
.poll-total-votes { font-weight: 500; }
.poll-action-btn { background: none; border: 1px solid var(--accent-color); color: var(--accent-color); padding: 4px 10px; border-radius: 15px; cursor: pointer; font-size: 12px; }
.poll-card.closed .poll-action-btn { background-color: #6c757d; color: white; border-color: #6c757d; }

/* --- 8.11 分享链接 (Link Share) --- */
.link-share-card { width: 210px; background-color: #fff; border-radius: 10px; border: 1px solid #e0e0e0; padding: 12px; cursor: pointer; transition: background-color 0.2s; display: flex; flex-direction: column; gap: 8px; }
.link-share-card:hover { background-color: #f9f9f9; }
.link-share-card .title { font-weight: 600; font-size: 15px; line-height: 1.4; color: #1f1f1f; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; }
.link-share-card .description { font-size: 13px; color: #8a8a8a; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; }
.link-share-card .footer { display: flex; align-items: center; gap: 6px; font-size: 12px; color: var(--text-secondary); margin-top: 4px; }
.link-share-card .footer-icon { width: 14px; height: 14px; flex-shrink: 0; }

/* --- 8.12 回忆与约定卡片 (Memory & Countdown Cards) --- */
.memory-card { background-color: #fffaf0; border-radius: 12px; padding: 15px; box-shadow: 0 2px 6px rgba(0,0,0,0.07); border-left: 5px solid #ffb74d; display: flex; flex-direction: column; gap: 8px; }
.memory-card .header { border-bottom: 1px solid rgba(217, 129, 0, 0.15); padding-bottom: 8px; }
.memory-card .header .date { font-size: 11px; color: #a1887f; margin-bottom: 4px; }
.memory-card .header .author { font-weight: 600; color: #d98100; font-size: 15px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.memory-card .content { font-size: 14px; line-height: 1.7; color: #5d4037; white-space: pre-wrap; }
.countdown-card { background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(118, 75, 162, 0.4); text-align: center; position: relative; overflow: hidden; flex-shrink: 0; }
.countdown-card::before { content: '✨'; position: absolute; top: -10px; left: -10px; font-size: 50px; opacity: 0.1; transform: rotate(-15deg); }
.countdown-card .title { font-size: 18px; font-weight: 600; margin-bottom: 15px; }
.countdown-card .timer { font-size: 28px; font-weight: 300; letter-spacing: 2px; margin-bottom: 15px; }
.countdown-card .target-date { font-size: 12px; opacity: 0.8; border-top: 1px solid rgba(255,255,255,0.2); padding-top: 10px; }

/* ===================================================================
   9. 动态 (QZone) 专属样式
   =================================================================== */

/* --- 9.1 动态界面布局 --- */
#qzone-screen { background-color: #f0f2f5; }
#qzone-screen .qzone-header { display: none; }
#qzone-screen.active .qzone-header { display: flex; }
#chat-list-screen.in-qzone-view > .header,
#chat-list-screen.in-qzone-view > #chat-list-bottom-nav { display: none; }
.qzone-content { flex-grow: 1; overflow-y: auto; }
.qzone-profile-header { position: relative; margin-bottom: 20px; }
.qzone-banner-container { width: 100%; height: 180px; position: relative; }
#qzone-banner-img { width: 100%; height: 100%; object-fit: cover; }
.qzone-user-info { position: absolute; bottom: -30px; left: 20px; display: flex; align-items: flex-end; gap: 10px; }
.qzone-avatar-container { position: relative; }
#qzone-avatar-img { width: 70px; height: 70px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.2); object-fit: cover; }
#qzone-nickname { font-size: 18px; font-weight: 600; color: #fff; text-shadow: 0 1px 3px rgba(0,0,0,0.5); padding-bottom: 5px; }
#qzone-banner-container, #qzone-avatar-container, #qzone-nickname { cursor: pointer; transition: opacity 0.2s; }
#qzone-banner-container:hover, #qzone-avatar-container:hover, #qzone-nickname:hover { opacity: 0.85; }

/* --- 9.2 动态功能与帖子列表 --- */
.qzone-actions-bar { display: flex; justify-content: space-around; padding: 10px 0; margin: 40px 15px 15px 15px; background-color: var(--secondary-bg); border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
.action-item { flex: 1; text-align: center; font-size: 15px; font-weight: 500; color: var(--text-primary); cursor: pointer; padding: 8px 0; position: relative; }
.action-item:not(:last-child)::after { content: ''; position: absolute; right: 0; top: 50%; transform: translateY(-50%); width: 1px; height: 20px; background-color: var(--border-color); }
#qzone-posts-list { padding: 0 15px 20px 15px; display: flex; flex-direction: column; gap: 20px; }

/* --- 9.3 单条动态卡片 (Post Item) --- */
.qzone-post-container { position: relative; overflow: hidden; border-radius: 12px; }
.qzone-post-item { background-color: var(--secondary-bg); border-radius: 12px; padding: 15px; box-shadow: 0 1px 4px rgba(0,0,0,0.06); transition: transform 0.3s ease; position: relative; z-index: 2; }
.post-header { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; }
.post-header .post-avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }
.post-info { display: flex; flex-direction: column; }
.post-info .post-nickname { font-weight: 600; font-size: 15px; color: var(--text-primary); }
.post-info .post-timestamp { font-size: 12px; color: var(--text-secondary); }
.post-actions-btn { margin-left: auto; padding: 5px 10px; font-size: 20px; font-weight: bold; color: var(--text-secondary); cursor: pointer; border-radius: 50%; line-height: 1; }
.post-actions-btn:hover { background-color: #f0f0f0; }
.post-content { font-size: 14px; line-height: 1.6; color: #333; white-space: pre-wrap; word-break: break-word; }
.qzone-post-delete-action { position: absolute; top: 0; right: 0; bottom: 0; width: 90px; background-color: #ff3b30; color: white; display: flex; align-items: center; justify-content: center; font-weight: 500; cursor: pointer; z-index: 1; }
.qzone-post-item.swiped { transform: translateX(-90px); }

/* --- 9.4 动态互动区 (Feedback & Comments) --- */
.post-feedback-icons { display: flex; justify-content: flex-end; align-items: center; gap: 12px; padding: 8px 0; }
.action-icon { cursor: pointer; color: var(--text-secondary); transition: all 0.2s ease-in-out; }
.action-icon svg { width: 22px; height: 22px; fill: none; stroke: currentColor; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
.action-icon.active { color: #ff5252; transform: scale(1.1); }
.action-icon.active.favorite { color: #ffc107; }
.action-icon.active svg { fill: currentColor; }
.post-likes-section { display: flex; align-items: center; gap: 6px; padding: 8px 10px; font-size: 13px; color: var(--accent-color); background-color: #f0f5fa; border-top: 1px solid #e9eef3; border-bottom: 1px solid #e9eef3; margin-top: 5px; }
.post-likes-section .like-icon { width: 16px; height: 16px; fill: currentColor; flex-shrink: 0; }
.post-footer { margin-top: 15px; padding-top: 10px; border-top: 1px solid #f0f0f0; display: flex; align-items: center; gap: 8px; }
.comment-section { flex-grow: 1; display: flex; align-items: center; gap: 8px; position: relative; }
.comment-section .comment-avatar { width: 28px; height: 28px; border-radius: 50%; object-fit: cover; flex-shrink: 0; }
.comment-section .comment-input { width: 100%; padding: 8px 12px; border: none; background-color: #f0f2f5; border-radius: 14px; font-size: 13px; outline: none; }
.comment-send-btn { flex-shrink: 0; padding: 8px 15px; border: none; background-color: var(--accent-color); color: white; border-radius: 14px; font-size: 13px; font-weight: 500; cursor: pointer; }
.post-comments-container { padding: 10px 0; display: flex; flex-direction: column; gap: 8px; font-size: 13px; }
.comment-item { line-height: 1.5; position: relative; padding-right: 25px; }
.comment-item .commenter-name { font-weight: 600; color: var(--accent-color); cursor: pointer; margin-right: 5px; }
.comment-item .comment-text { color: var(--text-primary); word-break: break-word; }
.comment-delete-btn { position: absolute; top: 50%; right: 0; transform: translateY(-50%); width: 22px; height: 22px; line-height: 22px; text-align: center; border-radius: 50%; color: var(--text-secondary); font-size: 18px; cursor: pointer; transition: all 0.2s ease; opacity: 0; }
.comment-item:hover .comment-delete-btn { opacity: 1; }
.comment-delete-btn:hover { background-color: #f0f0f0; color: #ff3b30; }
.at-mention-popup { position: absolute; bottom: 100%; left: 40px; width: calc(100% - 40px); max-height: 120px; overflow-y: auto; background-color: var(--secondary-bg); border: 1px solid var(--border-color); border-radius: 8px; box-shadow: 0 -4px 12px rgba(0,0,0,0.1); z-index: 10; display: none;
}
.at-mention-item { padding: 8px 12px; font-size: 14px; cursor: pointer; color: var(--text-primary); border-bottom: 1px solid #f0f0f0; }
.at-mention-item:last-child { border-bottom: none; }
.at-mention-item:hover { background-color: #f5f5f5; }

/* ===================================================================
   10. 各种模态框与浮层 (Modals & Overlays)
   =================================================================== */

/* --- 10.1 自定义模态框 (Custom Modal) --- */
#custom-modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); display: none; align-items: center; justify-content: center; z-index: 1000; opacity: 0; transition: opacity 0.2s ease-in-out; }
#custom-modal-overlay.visible { display: flex; opacity: 1; }
#custom-modal { background-color: #fff; width: 280px; border-radius: 14px; box-shadow: 0 4px 20px rgba(0,0,0,0.2); display: flex; flex-direction: column; transform: scale(0.95); transition: transform 0.2s ease-in-out; }
#custom-modal-overlay.visible #custom-modal { transform: scale(1); }
.custom-modal-header { padding: 16px; font-size: 17px; font-weight: 600; text-align: center; }
.custom-modal-body { padding: 0 16px 16px; text-align: center; font-size: 14px; color: #333; line-height: 1.5; }
.custom-modal-body p { margin: 0 0 12px 0; }
.custom-modal-body input { width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #ccc; font-size: 14px; box-sizing: border-box; }
.custom-modal-footer { border-top: 1px solid #dbdbdb; display: flex; }
.custom-modal-footer button { flex: 1; background: none; border: none; padding: 12px; font-size: 17px; cursor: pointer; color: var(--accent-color); }
.custom-modal-footer button:first-child { border-right: 1px solid #dbdbdb; }
.custom-modal-footer .confirm-btn { font-weight: 600; }
.custom-modal-footer .confirm-btn.btn-danger { color: #ff3b30; }

/* --- 10.2 操作菜单模态框 (Action Sheet Modal) --- */
#preset-actions-modal .custom-modal-footer,
#message-actions-modal .custom-modal-footer,
#post-actions-modal .custom-modal-footer { flex-direction: column; }
#preset-actions-modal .custom-modal-footer button,
#message-actions-modal .custom-modal-footer button,
#post-actions-modal .custom-modal-footer button { width: 100%; border: none; border-bottom: 1px solid #dbdbdb; padding: 14px; font-size: 18px; }
#preset-actions-modal .custom-modal-footer button:last-child,
#message-actions-modal .custom-modal-footer button:last-child,
#post-actions-modal .custom-modal-footer button:last-child { border-bottom: none; }
#preset-actions-modal #preset-action-cancel,
#message-actions-modal #cancel-message-action-btn,
#post-actions-modal #cancel-post-action-btn { margin-top: 8px; border-radius: 8px; background-color: #f0f0f0; }

/* --- 10.3 视频通话 (Video Call) --- */
#incoming-call-modal .incoming-call-content { background-color: rgba(40, 40, 40, 0.85); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border-radius: 20px; width: 280px; padding: 30px 20px; text-align: center; color: white; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
.caller-avatar { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; margin-bottom: 12px; border: 3px solid rgba(255,255,255,0.5); }
.caller-name { font-size: 20px; font-weight: 600; margin-bottom: 5px; }
.caller-text { font-size: 14px; color: #ccc; margin-bottom: 30px; }
.incoming-call-actions { display: flex; justify-content: space-around; align-items: center; }
.action-button-wrapper { display: flex; flex-direction: column; align-items: center; gap: 8px; font-size: 13px; color: #e0e0e0; }
.call-action-btn { width: 60px; height: 60px; border-radius: 50%; border: none; cursor: pointer; background-size: 50%; background-repeat: no-repeat; background-position: center; transition: transform 0.2s, box-shadow 0.2s; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
.call-action-btn:active { transform: scale(0.9); }
.call-action-btn.decline { background-color: #ff3b30; background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13.5 16.5L3 6m18 6l-5.6-5.6a1.2 1.2 0 0 0-1.7 0L3 18.2a1.2 1.2 0 0 0-.3 1.2l1.2 3.6a1.2 1.2 0 0 0 1.2.9h15.6a1.2 1.2 0 0 0 1.2-1.2V7.7a1.2 1.2 0 0 0-.3-1.1z"/></svg>'); }
.call-action-btn.accept { background-color: #4cd964; background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>'); animation: pulse 1.5s infinite; }

#outgoing-call-screen { background-color: #1c1c1e; color: white; justify-content: center; align-items: center; }
.outgoing-call-content { display: flex; flex-direction: column; align-items: center; text-align: center; }
.outgoing-call-actions { margin-top: 50px; display: flex; flex-direction: column; align-items: center; gap: 8px; font-size: 13px; color: #e0e0e0; }

#video-call-screen { background-color: #1c1c1e; color: white; display: flex; flex-direction: column; overflow: hidden; }
.video-call-top-bar { position: absolute; top: 0; left: 0; width: 100%; padding: 15px 20px; padding-top: 50px; background: linear-gradient(to bottom, rgba(0,0,0,0.5), transparent); z-index: 10; text-align: center; box-sizing: border-box; pointer-events: none; }
#call-timer { font-size: 16px; font-weight: 500; letter-spacing: 1px; }
.video-call-controls { position: absolute; bottom: 0; left: 0; width: 100%; display: flex; justify-content: space-around; align-items: center; padding: 20px 40px; background: linear-gradient(to top, rgba(0,0,0,0.5), transparent); z-index: 10; box-sizing: border-box; }
.video-call-avatar-area { flex-grow: 1; display: flex; justify-content: center; align-items: center; padding: 20px; padding-top: 80px; box-sizing: border-box; overflow-y: auto; }
#participant-avatars-grid { display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 15px; max-width: 100%; }
.participant-avatar-wrapper { position: relative; text-align: center; flex-shrink: 0; }
.participant-avatar { width: 70px; height: 70px; border-radius: 50%; object-fit: cover; border: 3px solid rgba(255, 255, 255, 0.2); transition: all 0.3s ease; }
.participant-name { margin-top: 8px; font-size: 12px; color: #ccc; }
.participant-avatar.speaking { border-color: #4cd964; box-shadow: 0 0 20px rgba(76, 217, 100, 0.6); transform: scale(1.05); }
#video-call-main { flex-shrink: 0; height: 30%; margin: 15px 15px 130px 15px; overflow-y: auto; padding: 15px; background-color: rgba(255, 255, 255, 0.05); border-radius: 20px; display: flex; flex-direction: column; gap: 15px; box-sizing: border-box; }
.control-btn { width: 70px; height: 70px; border-radius: 50%; border: none; cursor: pointer; background-repeat: no-repeat; background-position: center; transition: transform 0.2s, background-color 0.2s; }
.control-btn:active { transform: scale(0.9); }
.control-btn.speak-btn { background-color: rgba(255,255,255,0.2); background-size: 55%; background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="white" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>'); }
.control-btn.hangup-btn { background-color: #ff3b30; background-size: 50%; background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13.5 16.5L3 6m18 6l-5.6-5.6a1.2 1.2 0 0 0-1.7 0L3 18.2a1.2 1.2 0 0 0-.3 1.2l1.2 3.6a1.2 1.2 0 0 0 1.2.9h15.6a1.2 1.2 0 0 0 1.2-1.2V7.7a1.2 1.2 0 0 0-.3-1.1z"/></svg>'); }
.control-btn.join-btn { background-color: #007bff; background-size: 50%; background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="8.5" cy="7" r="4"></circle><line x1="20" y1="8" x2="20" y2="14"></line><line x1="17" y1="11" x2="23" y2="11"></line></svg>'); }
.call-message-bubble { padding: 10px 15px; border-radius: 12px; max-width: 85%; line-height: 1.6; word-break: break-word; white-space: pre-wrap; }
.call-message-bubble.ai-speech { background-color: rgba(255, 255, 255, 0.15); align-self: flex-start; }
.call-message-bubble.user-speech { background-color: #4cd964; align-self: flex-end; text-align: left; }

/* --- 10.4 音乐播放器 (Music Player) --- */
#music-player-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 50; display: flex; justify-content: center; align-items: flex-start; padding-top: 60px; background-color: rgba(0,0,0,0.3); opacity: 0; visibility: hidden; transform: translateY(-50px); transition: opacity 0.4s ease-out, transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); }
#music-player-overlay.visible { opacity: 1; visibility: visible; transform: translateY(0); }
.music-player-window { width: 70%; min-height: 420px; background-color: rgba(255, 255, 255, 0.6); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border-radius: 25px; box-shadow: 0 8px 32px 0 rgba(25, 25, 25, 0.37); border: 1px solid rgba(255, 255, 255, 0.18); padding: 25px 25px 15px; display: flex; flex-direction: column; align-items: center; justify-content: space-between; color: #1f1f1f; position: relative; }
.music-player-top-actions { position: absolute; top: 15px; left: 15px; right: 15px; width: calc(100% - 30px); display: flex; justify-content: space-between; align-items: center; }
.top-left-cluster { display: flex; align-items: center; gap: 15px; }
#music-return-btn, #music-exit-btn, #music-playlist-btn { background: none; border: none; cursor: pointer; color: #555; padding: 5px; line-height: 1; position: relative; }
#music-return-btn { font-size: 28px; font-weight: 300; top: -2px; }
#music-exit-btn { font-size: 24px; font-weight: 400; }
#music-playlist-btn { font-size: 24px; top: -3px; }
#music-time-counter { font-size: 12px; color: #555; margin-bottom: 20px; }
#music-player-song-title { font-size: 20px; font-weight: 600; margin-bottom: 5px; text-align: center; }
#music-player-artist { font-size: 14px; color: #666; margin-bottom: 25px; }
.music-player-controls-wrapper { width: 100%; display: flex; flex-direction: column; gap: 10px; }
.music-progress-bar-container { width: 100%; display: flex; align-items: center; gap: 10px; margin-top: 25px; margin-bottom: 10px; }
.time-display { font-size: 11px; color: #888; width: 35px; text-align: center; flex-shrink: 0; font-family: 'SF Mono', 'Menlo', monospace; }
.progress-bar { flex-grow: 1; height: 5px; background-color: #e5e5e5; border-radius: 2.5px; cursor: pointer; }
.progress-bar-fill { width: 0%; height: 100%; background-color: #333; border-radius: 2.5px; }
#music-lyrics-container { width: 100%; height: 192px; overflow: hidden; position: relative; -webkit-mask-image: linear-gradient(transparent, black 20%, black 80%, transparent); mask-image: linear-gradient(transparent, black 20%, black 80%, transparent); }
#music-lyrics-list { display: flex; flex-direction: column; align-items: center; transition: transform 0.5s cubic-bezier(0.25, 0.1, 0.25, 1); }
.lyric-line { padding: 4px 0; font-size: 14px; color: #666; text-align: center; line-height: 1.5; transition: all 0.5s ease; opacity: 0.7; transform: scale(0.95); }
.lyric-line.active { font-size: 16px; color: #000; opacity: 1; transform: scale(1); }
.music-controls { display: flex; align-items: center; justify-content: center; gap: 20px; width: 100%; }
.music-controls button { background: none; border: none; font-size: 16px; font-weight: bold; cursor: pointer; color: #333; width: 44px; height: 44px; display: flex; justify-content: center; align-items: center; transition: transform 0.2s; }
.music-controls button:active { transform: scale(0.9); }
.music-controls .play-pause-btn { font-size: 24px; width: 60px; height: 60px; border-radius: 50%; background-color: rgba(0,0,0,0.05); }
#listen-together-btn img.rotating { animation: spin 2s linear infinite; }
#listen-together-btn img.paused { animation-play-state: paused; }
#music-playlist-panel { position: absolute; bottom: 0; left: 0; width: 100%; height: 70%; background-color: rgba(242, 242, 247, 0.9); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); border-top: 1px solid var(--border-color); border-radius: 20px 20px 0 0; z-index: 210; display: flex; flex-direction: column; transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); visibility: hidden; }
#music-playlist-panel.visible { transform: translateY(0); visibility: visible; }
.playlist-header { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; border-bottom: 1px solid var(--border-color); font-weight: 600; }
.playlist-header .panel-btn { font-size: 16px; cursor: pointer; color: var(--accent-color); }
.playlist-body { flex-grow: 1; overflow-y: auto; padding: 10px 0; }
.playlist-item { padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; border-bottom: 1px solid #eee; }
.playlist-item.playing { background-color: rgba(0, 123, 255, 0.1); }
.playlist-item-info .title { font-weight: 500; font-size: 15px; }
.playlist-item-info .artist { font-size: 12px; color: #666; }
.playlist-item-actions { display: flex; align-items: center; gap: 15px; }
.playlist-action-btn { font-size: 18px; color: #888; cursor: pointer; transition: color 0.2s; }
.playlist-action-btn:hover { color: #000; }
.delete-track-btn { font-size: 24px; color: #ff3b30; }
.delete-track-btn:hover { color: #c00; }
.lyrics-btn { font-weight: 500; }

/* --- 10.5 图片查看器 (Photo Viewer) --- */
#photo-viewer-modal { background-color: rgba(0, 0, 0, 0.85); z-index: 1002; -webkit-backdrop-filter: blur(5px); backdrop-filter: blur(5px); }
.photo-viewer-content { display: flex; justify-content: center; align-items: center; width: 100%; height: 100%; }
#photo-viewer-image { max-width: 90vw; max-height: 85vh; object-fit: contain; border-radius: 8px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); transition: opacity 0.2s ease-in-out; }
#photo-viewer-close-btn { position: absolute; top: 20px; right: 20px; background: none; border: none; color: white; font-size: 40px; font-weight: 200; cursor: pointer; line-height: 1; text-shadow: 0 0 5px black; }
#photo-viewer-modal .nav-arrow { position: absolute; top: 50%; transform: translateY(-50%); background: none; border: none; color: rgba(255, 255, 255, 0.7); font-size: 50px; font-weight: 100; cursor: pointer; padding: 10px; user-select: none; transition: color 0.2s; z-index: 1003; }
#photo-viewer-prev-btn { left: 5px; }
#photo-viewer-next-btn { right: 5px; }
#photo-viewer-modal .nav-arrow:hover { color: white; }
#photo-viewer-modal .nav-arrow:disabled { color: rgba(255, 255, 255, 0.2); cursor: default; }

/* ... (other modals and overlays) ... */
#battery-alert-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.4); display: none; justify-content: center; align-items: center; z-index: 2000; opacity: 0; transition: opacity 0.3s ease; }
#battery-alert-modal.visible { display: flex; opacity: 1; }
.battery-alert-content { background-color: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); width: 280px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.2); text-align: center; padding: 20px; cursor: pointer; transform: scale(0.9); transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
#battery-alert-modal.visible .battery-alert-content { transform: scale(1); }
#battery-alert-image { max-width: 100px; max-height: 100px; margin-bottom: 15px; }
#battery-alert-text { font-size: 16px; font-weight: 500; color: #333; margin: 0; line-height: 1.4; }
.frame-tabs { display: flex; background-color: #f0f0f0; padding: 4px; margin: 15px; border-radius: 8px; }
.frame-tab { flex: 1; text-align: center; padding: 8px; font-size: 14px; font-weight: 500; color: #555; cursor: pointer; border-radius: 6px; transition: all 0.2s ease-in-out; }
.frame-tab.active { background-color: #ffffff; color: #000000; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }

/* ===================================================================
   11. 动画 (Animations)
   =================================================================== */
@keyframes charge-breath { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
@keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(76, 217, 100, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(76, 217, 100, 0); } 100% { box-shadow: 0 0 0 0 rgba(76, 217, 100, 0); } }
@keyframes like-bounce { 0% { transform: scale(1); } 25% { transform: scale(0.8); } 50% { transform: scale(1.2); } 75% { transform: scale(1.05); } 100% { transform: scale(1.1); } }
@keyframes message-pop-in { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
@keyframes pat-shake { 0%, 100% { transform: translateX(0); } 10%, 30%, 50%, 70%, 90% { transform: translateX(-3px); } 20%, 40%, 60%, 80% { transform: translateX(3px); } }
@keyframes typing-pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
@keyframes recall-animation { from { opacity: 1; transform: scale(1); } to { opacity: 0; transform: scale(0.8); } }
@keyframes wave-quiet { 0%, 100% { height: 2px; } 50% { height: 10px; } }

/* ===================================================================
   12. 夜间模式 (Dark Mode)
   =================================================================== */
#phone-screen.dark-mode { --secondary-bg: #1c1c1e; --border-color: #38383a; --text-primary: #f0f0f0; --text-secondary: #8d8d92;
}

/* --- 12.1 Dark Mode: 背景与导航 --- */
#phone-screen.dark-mode #chat-list-screen,
#phone-screen.dark-mode #qzone-screen .qzone-content,
#phone-screen.dark-mode #memories-view,
#phone-screen.dark-mode #api-settings-screen,
#phone-screen.dark-mode #font-settings-screen,
#phone-screen.dark-mode #wallpaper-screen,
#phone-screen.dark-mode #contact-picker-screen,
#phone-screen.dark-mode #member-management-screen,
#phone-screen.dark-mode #world-book-editor-screen,
#phone-screen.dark-mode #world-book-list,
#phone-screen.dark-mode .list-container,
#phone-screen.dark-mode .form-container,
#phone-screen.dark-mode .search-bar-container { background-color: #000000;
}
#phone-screen.dark-mode .header,
#phone-screen.dark-mode .qzone-header { background-color: rgba(25, 25, 25, 0.9); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); border-bottom-color: #38383a; color: #ffffff;
}
#phone-screen.dark-mode .header .back-btn,
#phone-screen.dark-mode .header .action-btn,
#phone-screen.dark-mode .header .save-btn { color: #ffffff; }
#phone-screen.dark-mode #chat-list-bottom-nav { background-color: rgba(25, 25, 25, 0.9); border-top-color: #38383a; }
#phone-screen.dark-mode .nav-item.active { color: #ffffff; }

/* --- 12.2 Dark Mode: 聊天列表 --- */
#phone-screen.dark-mode #chat-list { background-color: #000000; }
#phone-screen.dark-mode .chat-list-item { border-bottom-color: #38383a; }
#phone-screen.dark-mode .chat-list-item:hover { background-color: #1c1c1e; }
#phone-screen.dark-mode .chat-list-item .name { color: #ffffff; }
#phone-screen.dark-mode .chat-group-header { background-color: #1c1c1e; border-bottom: 1px solid #38383a; }
#phone-screen.dark-mode .chat-group-header .group-name { color: #ffffff; }

/* --- 12.3 Dark Mode: 聊天界面 --- */
#phone-screen.dark-mode #chat-input-area { background-color: rgba(5, 5, 5, 0.8); border-top: none; }
#phone-screen.dark-mode #chat-input { background-color: #3e3e42; color: #ffffff; }
#phone-screen.dark-mode #chat-input::placeholder { color: #8d8d92; }
#phone-screen.dark-mode .chat-action-icon-btn { color: #ffffff; background-color: rgba(255, 255, 255, 0.1); border: none; }
#phone-screen.dark-mode #reply-preview-bar { background-color: rgba(255, 255, 255, 0.1); }
#phone-screen.dark-mode .quoted-message { background-color: rgba(255, 255, 255, 0.08); border-left-color: #a0cff1; }
#phone-screen.dark-mode .quoted-message .quoted-sender { color: #a0cff1; }
#phone-screen.dark-mode .voice-transcript { background-color: rgba(255, 255, 255, 0.1); }
#phone-screen.dark-mode .recalled-message-placeholder,
#phone-screen.dark-mode .system-message,
#phone-screen.dark-mode .message-bubble.system-bubble { background-color: rgba(255, 255, 255, 0.15); }

/* --- 12.4 Dark Mode: 动态 (QZone) --- */
#phone-screen.dark-mode .qzone-actions-bar,
#phone-screen.dark-mode .qzone-post-item { background-color: #1c1c1e; border: 1px solid #333; box-shadow: 0 2px 8px rgba(255, 255, 255, 0.05); }
#phone-screen.dark-mode .action-item:not(:last-child)::after { background-color: #333; }
#phone-screen.dark-mode .post-footer,
#phone-screen.dark-mode .post-likes-section { border-top-color: #333; }
#phone-screen.dark-mode .post-likes-section { background-color: rgba(0, 123, 255, 0.1); }
#phone-screen.dark-mode .comment-input { background-color: #333; color: #ffffff; }
#phone-screen.dark-mode .comment-input::placeholder { color: #8d8d92; }
#phone-screen.dark-mode .post-actions-btn:hover { background-color: #333; }
#phone-screen.dark-mode .at-mention-popup { background-color: #1c1c1e; border-color: #333; }
#phone-screen.dark-mode .at-mention-item { border-bottom-color: #333; }
#phone-screen.dark-mode .at-mention-item:hover { background-color: #333; }
#phone-screen.dark-mode .world-book-group-header,
#phone-screen.dark-mode .wb-category-header { background-color: #1c1c1e; }

/* --- 12.5 Dark Mode: 表单与设置 --- */
#phone-screen.dark-mode .form-group input,
#phone-screen.dark-mode .form-group select,
#phone-screen.dark-mode .form-group textarea { background-color: #1c1c1e; color: #ffffff; border-color: #38383a; }
#phone-screen.dark-mode .form-button-secondary { background-color: #333; border-color: #555; color: #fff; }
#phone-screen.dark-mode #font-preview { background-color: #1c1c1e; border-color: #38383a; }
#phone-screen.dark-mode #font-preview p { color: #ffffff; }
#phone-screen.dark-mode #favorites-search-input { background-color: #1c1c1e; border-color: #38383a; color: #ffffff; }
#phone-screen.dark-mode #favorites-search-input::placeholder { color: #8d8d92; }

/* --- 12.6 Dark Mode: 卡片内容修正 --- */
#phone-screen.dark-mode .qzone-post-item .post-nickname,
#phone-screen.dark-mode .qzone-post-item .post-content,
#phone-screen.dark-mode .favorite-item-card .fav-card-header .name,
#phone-screen.dark-mode .favorite-item-card .fav-card-content,
#phone-screen.dark-mode .memory-card .content { color: #f0f0f0; }
#phone-screen.dark-mode .favorite-item-card .fav-card-header .source { color: #8d8d92; }
#phone-screen.dark-mode .memory-card { background-color: #1c1c1e; border-left-color: #e6a753; box-shadow: 0 4px 12px rgba(255, 255, 255, 0.08); }
#phone-screen.dark-mode .memory-card .header { background-color: #2c2c2e; border-bottom-color: #38383a; margin: -15px -15px 8px -15px; padding: 12px 15px; border-radius: 12px 12px 0 0; }
#phone-screen.dark-mode .memory-card .header .date,
#phone-screen.dark-mode .memory-card .header .author { color: #e0e0e0; }